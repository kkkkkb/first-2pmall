{"version":3,"sources":["elements.onpage-help.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"elements.onpage-help.js","sourcesContent":["/**\r\n <b>Onpage Help</b>. You can use this to provide help dialogs on your application pages. See docs for more info.\r\n*/\r\n\r\nwindow.Onpage_Help = function(options) {\r\n\tvar $ = window.jQuery || null;\r\n\tif($ == null) return;\r\n\r\n\toptions = options || {}\r\n\tvar defaults = {\r\n\t\tinclude_all: true,\r\n\t\ticon_1: 'fa fa-question',\r\n\t\ticon_2: 'fa fa-lightbulb-o',\r\n\t\tbase: '',\r\n\t\tcode_highlight: (!!window.Rainbow ? 'rainbow' : (!!window.Prism ? 'prism' : null)),\r\n\r\n\t\tadd_panels: true,\r\n\t\tpanel_content_selector: '.info-section',\r\n\t\tpanel_content_title: '.info-title'\r\n\t}\r\n\tthis.settings = $.extend({}, defaults, options);\r\n\t\r\n\r\n\tvar $base = this.settings['base'];\r\n\tvar ie_fix = document.all && !window.atob;//ie9 and below need a little fix\r\n\r\n\tvar section_start = {};\r\n\tvar section_end = {};\r\n\tvar section_rect = {};\r\n\tvar section_count = 0;\r\n\t\r\n\tvar created = false;\r\n\tvar active = false;\r\n\t\r\n\tvar self = this, _ = this;\r\n\tvar ovfx = '';\r\n\tvar help_container = null;\r\n\t\r\n\tvar body_h, body_w;\r\n\t\r\n\tvar captureFocus = function() {\r\n\t\tif(!help_container) return;\r\n\t\tvar scroll = -1;\r\n\t\t//like bootstrap modal\r\n\t\t$(document)\r\n\t\t.off('focusin.ace.help') //remove any previously attached handler\r\n\t\t.on('focusin.ace.help', function (e) {\r\n\t\t\tif (!( help_container[0] == e.target || $.contains(help_container[0], e.target) )) {\r\n\t\t\t  help_container.focus();\r\n\t\t\t}\r\n\r\n\t\t\tif(e.target == document && scroll > -1) {\r\n\t\t\t\t//when window regains focus and container is focused, it scrolls to bottom\r\n\t\t\t\t//so we put it back to its place\r\n\t\t\t\t$('body,html').scrollTop(scroll);\r\n\t\t\t\tscroll = -1;\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\t$(window).on('blur.ace.help', function(){\r\n\t\t\tscroll = $(window).scrollTop();\r\n\t\t});\r\n\t}\r\n\tvar releaseFocus = function() {\r\n\t\t$(document).off('focusin.ace.help');\r\n\t\t$(window).off('blur.ace.help');\r\n\t}\r\n\r\n\r\n\tthis.toggle = function() {\r\n\t\tif(active) {\r\n\t\t\tself.disable();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tself.enable();\r\n\t\t}\r\n\t}\r\n\r\n\tthis.enable = function() {\r\n\t\tif(active) return;\r\n\t\tif(typeof _.settings.before_enable === 'function' && _.settings.before_enable.call(self) === false) return;\r\n\t\t////\r\n\r\n\t\t//if( !created ) this.init();\r\n\t\tactive = true;\r\n\t\t\r\n\t\t$('.onpage-help-backdrop, .onpage-help-section').removeClass('hidden');\r\n\t\t\r\n\t\tovfx = document.body.style.overflowX;\r\n\t\tdocument.body.style.overflowX = 'hidden';//hide body:overflow-x\r\n\t\t\r\n\t\tdisplay_help_sections();\r\n\t\tcaptureFocus();\r\n\r\n\t\t////\r\n\t\tif(typeof _.settings.after_enable === 'function') _.settings.after_enable.call(self);\r\n\t}\r\n\t\r\n\tthis.disable = function() {\r\n\t\tif(!active) return;\r\n\t\tif(typeof _.settings.before_disable === 'function' && _.settings.before_disable.call(self)) return;\r\n\t\t////\r\n\t\t\t\t\r\n\t\tactive = false;\r\n\t\t$('.onpage-help-backdrop, .onpage-help-section').addClass('hidden');\r\n\r\n\t\tdocument.body.style.overflowX = ovfx;//restore body:overflow-x\r\n\t\treleaseFocus();\r\n\t\t\r\n\t\t////\r\n\t\tif(typeof _.settings.after_disable === 'function') _.settings.after_disable.call(self);\r\n\t}\r\n\t\r\n\tthis.is_active = function() {\r\n\t\treturn active;\r\n\t}\r\n\tthis.show_section_help = function(section) {\r\n\t\tlaunch_help_modal(section, true);\r\n\t}\r\n\t\r\n\t\r\n\tthis.init = function() {\r\n\t\tif( created ) return;\r\n\t\r\n\t\thelp_container = \r\n\t\t$('<div class=\"onpage-help-container\" id=\"onpage-help-container\" tabindex=\"-1\" />')\r\n\t\t.appendTo('body');\r\n\r\n\t\thelp_container.append('<div class=\"onpage-help-backdrop hidden\" />')\r\n\r\n\t\t//update to correct position and size\r\n\t\t$(window).on('resize.onpage_help', function() {\r\n\t\t\tif(!active) return;\r\n\t\t\tdisplay_help_sections();\r\n\t\t\t\r\n\t\t\tif( help_modal != null && help_modal.hasClass('in') ) {\r\n\t\t\t\tsetBodyHeight();\t\t\t\t\r\n\t\t\t\tdisableBodyScroll();\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\tcreated = true;\r\n\t}\r\n\tthis.init();//create once at first\r\n\t\r\n\r\n\t///////////////////////////\r\n\tthis.update_sections = function() {\r\n\t\tsave_sections(true);//reset sections, maybe because of new elements and comments inserted into DOM\r\n\t}\r\n\r\n\r\n\tfunction display_help_sections() {\r\n\t\tif(!active) return;\r\n\r\n\t\tsave_sections();//finds comments and relevant help sections\r\n\r\n\t\tbody_h = document.body.scrollHeight - 2;\r\n\t\tbody_w = document.body.scrollWidth - 2;\r\n\r\n\t\t//we first calculate all positions\r\n\t\t//because if we calculate one position and then make changes to DOM,\r\n\t\t//next position calculation will become slow on Webkit, because it tries to re-calculate layout changes and things\r\n\t\t//i.e. we batch call all and save offsets and scrollWidth, etc and then use them later in highlight_section\r\n\t\t//Firefox doesn't have such issue\r\n\t\tfor(var name in section_start) {\r\n\t\t\tif(section_start.hasOwnProperty(name)) {\r\n\t\t\t\tsave_section_offset(name);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor(var name in section_start) {\r\n\t\t\tif(section_start.hasOwnProperty(name)) {\r\n\t\t\t\thighlight_section(name);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t\r\n\t//finds comments and relevant help sections\r\n\tfunction save_sections(reset) {\r\n\t\tif( !(reset === true || section_count == 0) ) return;//no need to re-calculate sections, then return\r\n\t\tif(reset === true) help_container.find('.onpage-help-section').remove();\r\n\r\n\t\tsection_start = {};\r\n\t\tsection_end = {};\r\n\t\tsection_count = 0;\r\n\t\t\r\n\t\tvar count1 = 0, count2 = 0;\r\n\t\t\r\n\t\t//find all relevant comments\r\n\t\tvar comments = $('*').contents().filter(function(){ return this.nodeType == 8/**Node.COMMENT_NODE;*/ })\r\n\t\t$(comments).each(function() {\r\n\t\t\tvar match\r\n\t\t\tif( (match = $.trim(this.data).match(/#section\\s*:\\s*([\\w\\d\\-\\.\\/]+)/i)) ) {\r\n\t\t\t\tvar section_name = match[1];\r\n\t\t\t\tif( !(section_name in section_start) ) \tsection_start[ section_name ] = this;\r\n\t\t\t}\r\n\t\t\tif( (match = $.trim(this.data).match(/\\/section\\s*:\\s*([\\w\\d\\-\\.\\/]+)/i)) ) {\r\n\t\t\t\tvar section_name = match[1];\r\n\t\t\t\tif( !(section_name in section_end) && (section_name in section_start) ) {\r\n\t\t\t\t\tsection_end[ section_name ] = this;\r\n\t\t\t\t\tsection_count++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\r\n\t\r\n\tfunction save_section_offset(name) {\r\n\t\tif( !(name in section_start) || !(name in section_end) ) return;\r\n\t\t\r\n\t\tvar x1 = 1000000, y1 = 1000000, x2 = -1000000, y2 = -1000000;\r\n\t\tvar visible = false;\r\n\r\n\t\t\r\n\t\tvar elements = [];\r\n\t\t\r\n\t\tvar start = section_start[name];\r\n\t\tvar end = section_end[name];\r\n\t\twhile(start != end) {\r\n\t\t\tstart = start.nextSibling;\r\n\t\t\tif(start == null) break;\r\n\t\t\telse if(start.nodeType == 1 /**Node.ELEMENT_NODE*/) elements.push(start);\r\n\t\t}\r\n\r\n\t\tvar elen = elements.length;\r\n\t\tif(elen > 0 && !_.settings['include_all']) {\r\n\t\t\t//calculate dimension of only first and last element\r\n\t\t\telements = elen == 1 ? [elements[0]] : [elements[0], elements[elen - 1]]\r\n\t\t}\r\n\r\n\t\t$(elements).each(function() {\r\n\t\t\tvar $this = $(this);\r\n\t\t\tif( $this.is(':hidden') ) return;\r\n\t\t\t\r\n\t\t\tvar off = $this.offset();\r\n\t\t\tvar w = $this.outerWidth();\r\n\t\t\tvar h = $this.outerHeight();\r\n\t\t\t\r\n\t\t\tif( !off || !w || !h ) return;\r\n\t\t\t\r\n\t\t\tvisible = true;\r\n\t\t\tif(off.left < x1) x1 = off.left;\r\n\t\t\tif(off.left + w > x2) x2 = off.left + w;\r\n\t\t\t\r\n\t\t\tif(off.top < y1) y1 = off.top;\r\n\t\t\tif(off.top + h > y2) y2 = off.top + h;\r\n\t\t});\r\n\t\t\r\n\t\t\t\t\t\r\n\t\tif( !visible ) {\r\n\t\t\tsection_rect[name] = {is_hidden: true}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tx1 -= 1;\r\n\t\ty1 -= 1;\r\n\t\tx2 += 1;\r\n\t\ty2 += 1;\r\n\t\t\r\n\t\t\r\n\t\tvar width = x2 - x1, height = y2 - y1;\r\n\t\t//section_rect is out of window ???\r\n\t\tif(x1 + width < 2 || x1 > body_w || y1 + height < 2 || y1 > body_h ) {\r\n\t\t\tsection_rect[name] = {is_hidden: true}\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsection_rect[name] = {\r\n\t\t\t'left': parseInt(x1),\r\n\t\t\t'top': parseInt(y1),\r\n\t\t\t'width': parseInt(width),\r\n\t\t\t'height': parseInt(height)\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tfunction highlight_section(name) {\r\n\t\tif( !(name in section_rect) || !help_container ) return;\r\n\r\n\t\t//div is the highlighted box above each section\r\n\t\tvar div = help_container.find('.onpage-help-section[data-section=\"'+name+'\"]').eq(0);\r\n\t\tif(div.length == 0)\t{\r\n\t\t\tdiv = $('<a class=\"onpage-help-section\" href=\"#\" />').appendTo(help_container);\r\n\t\t\tif(ie_fix) div.append('<span class=\"ie-hover-fix\" />');\r\n\t\t\t\r\n\t\t\tif(_.settings.icon_1) div.append('<i class=\"help-icon-1 '+_.settings.icon_1+'\"></i>');\r\n\t\t\tif(_.settings.icon_2) div.append('<i class=\"help-icon-2 '+_.settings.icon_2+'\"></i>');\r\n\t\t\t\r\n\t\t\tdiv.attr('data-section', name);\r\n\r\n\t\t\tdiv.on('click', function(e) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tlaunch_help_modal(name);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tvar rect = section_rect[name];\r\n\t\tif(rect['is_hidden'] === true) {\r\n\t\t\tdiv.addClass('hidden');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tdiv.css({\r\n\t\t\tleft: rect.left,\r\n\t\t\ttop: rect.top,\r\n\t\t\twidth: rect.width,\r\n\t\t\theight: rect.height\r\n\t\t});\r\n\t\t\r\n\r\n\t\tdiv.removeClass('hidden');\r\n\t\tdiv.removeClass('help-section-small help-section-smaller');\r\n\t\tif(rect.height < 55 || rect.width < 55) {\r\n\t\t\tdiv.addClass('help-section-smaller');\r\n\t\t}\r\n\t\telse if(rect.height < 75 || rect.width < 75) {\r\n\t\t\tdiv.addClass('help-section-small');\r\n\t\t}\r\n\t}\r\n\t\r\n\r\n\tvar nav_list = [];\r\n\tvar nav_pos = -1;\r\n\tvar mbody = null;\r\n\tvar maxh = 0;\r\n\tvar help_modal = null;\r\n\r\n\t//disable body scroll, when modal content has no scrollbars or reached end of scrolling\r\n\tfunction disableBodyScroll() {\r\n\t\tif (!mbody) return;\r\n\t\t\r\n\t\tvar body = mbody[0];\r\n\t\tvar disableScroll = body.scrollHeight <= body.clientHeight;\r\n\t\t\r\n\t\t//mousewheel library available?\r\n\t\tvar mousewheel_event = !!$.event.special.mousewheel ? 'mousewheel.ace.help' : 'mousewheel.ace.help DOMMouseScroll.ace.help';\r\n\r\n\t\tmbody.parent()\r\n\t\t.off(mousewheel_event)\r\n\t\t.on(mousewheel_event, function(event) {\r\n\t\t\tif(disableScroll) event.preventDefault();\r\n\t\t\telse {\r\n\t\t\t\tevent.deltaY = event.deltaY || 0;\r\n\t\t\t\tvar delta = (event.deltaY > 0 || event.originalEvent.detail < 0 || event.originalEvent.wheelDelta > 0) ? 1 : -1\r\n\r\n\t\t\t\tif(delta == -1 && body.scrollTop + body.clientHeight >= body.scrollHeight) event.preventDefault();\r\n\t\t\t\telse if(delta == 1 && body.scrollTop <= 0) event.preventDefault();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\tfunction setBodyHeight() {\r\n\t\tif (!mbody) return;\r\n\t\t\r\n\t\tvar diff = parseInt(help_modal.find('.modal-dialog').css('margin-top'));\r\n\t\tdiff = diff + 110 + parseInt(diff / 2);\r\n\t\tmaxh = parseInt( $(window).innerHeight() - diff + 40 );\r\n\t\tmbody.css({'max-height': maxh});\r\n\t}\r\n\r\n\r\n\tfunction launch_help_modal(section_name, save_to_list) {\r\n\t\tif(help_modal == null) {\r\n\t\t\thelp_modal = $('<div id=\"onpage-help-modal\" class=\"modal onpage-help-modal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"HelpModalDialog\" aria-hidden=\"true\">\\\r\n\t\t\t  <div class=\"modal-dialog modal-lg\">\\\r\n\t\t\t\t<div class=\"modal-content\">\\\r\n\t\t\t\t\t<div class=\"modal-header\">\\\r\n\t\t\t\t\t  <div class=\"pull-right onpage-help-modal-buttons\">\\\r\n\t\t\t\t\t\t<button aria-hidden=\"true\" data-navdir=\"up\" type=\"button\" class=\"disabled btn btn-white btn-success btn-sm\"><i class=\"ace-icon fa fa-level-up fa-flip-horizontal bigger-125 icon-only\"></i></button>\\\r\n\t\t\t\t\t\t&nbsp;\\\r\n\t\t\t\t\t\t<button aria-hidden=\"true\" data-navdir=\"back\" type=\"button\" class=\"disabled btn btn-white btn-info btn-sm\"><i class=\"ace-icon fa fa-arrow-left icon-only\"></i></button>\\\r\n\t\t\t\t\t\t<button aria-hidden=\"true\" data-navdir=\"forward\" type=\"button\" class=\"disabled btn btn-white btn-info  btn-sm\"><i class=\"ace-icon fa fa-arrow-right icon-only\"></i></button>\\\r\n\t\t\t\t\t\t&nbsp;\\\r\n\t\t\t\t\t\t<button aria-hidden=\"true\" data-dismiss=\"modal\" class=\"btn btn-white btn-danger btn-sm\" type=\"button\"><i class=\"ace-icon fa fa-times icon-only\"></i></button>\\\r\n\t\t\t\t\t  </div>\\\r\n\t\t\t\t\t  <h4 class=\"modal-title\">Help Dialog</h4>\\\r\n\t\t\t\t\t</div>\\\r\n\t\t\t\t\t<div class=\"modal-body\"><div class=\"onpage-help-content\"></div></div>\\\r\n\t\t\t\t</div>\\\r\n\t\t\t  </div>\\\r\n\t\t\t</div>').appendTo('body');\r\n\t\t\r\n\t\t\tmbody = help_modal.find('.modal-body');\r\n\t\t\tmbody.css({'overflow-y': 'auto', 'overflow-x': 'hidden'});\r\n\t\t\t\r\n\t\t\thelp_modal.css({'overflow' : 'hidden'})\r\n\t\t\t.on('show.bs.modal', function() {\r\n\t\t\t\treleaseFocus();\r\n\t\t\t})\r\n\t\t\t.on('hidden.bs.modal', function() {\r\n\t\t\t\tcaptureFocus();\r\n\t\t\t})\r\n\t\t\t\r\n\t\t\thelp_modal.find('.onpage-help-modal-buttons').on('click', 'button[data-navdir]', function() {\r\n\t\t\t\tvar dir = $(this).attr('data-navdir');\r\n\t\t\t\tif(dir == 'back') {\r\n\t\t\t\t\tif(nav_pos > 0) {\r\n\t\t\t\t\t\tnav_pos--;\r\n\t\t\t\t\t\tlaunch_help_modal(nav_list[nav_pos], false);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse if(dir == 'forward') {\r\n\t\t\t\t\tif(nav_pos < nav_list.length - 1) {\r\n\t\t\t\t\t\tnav_pos++;\r\n\t\t\t\t\t\tlaunch_help_modal(nav_list[nav_pos], false);//don't save to history list, already in the list\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse if(dir == 'up') {\r\n\t\t\t\t\tvar $this = $(this), url;\r\n\t\t\t\t\tif( $this.hasClass('disabled') || !(url = $this.attr('data-url')) ) return;\r\n\t\t\t\t\t\r\n\t\t\t\t\tlaunch_help_modal(url , true);//add to history list\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\r\n\t\tif( !help_modal.hasClass('in') ) {\r\n\t\t\tif( document.body.lastChild != help_modal[0] ) $(document.body).append(help_modal);//move it to become the last child of body\r\n\t\t\thelp_modal.modal('show');\r\n\t\t\t\r\n\t\t\tsetBodyHeight();\r\n\t\t}\r\n\r\n\t\thelp_modal.find('.modal-title').wrapInner(\"<span class='hidden' />\").append('<i class=\"fa fa-spinner fa-spin blue bigger-125\"></i>');\r\n\t\tvar content = $('.onpage-help-content');\r\n\t\tcontent.addClass('hidden')\r\n\t\t\r\n\t\t$(document.body).removeClass('modal-open');//modal by default hides body scrollbars, but we don't want to do so, because on modal hide, a winow resize is triggered\r\n\t\t\r\n\t\tvar parts = section_name.match(/file\\:(.*?)\\:(.+)/i);\r\n\t\tif(parts && parts.length == 3) {\r\n\t\t\tdisplay_codeview(parts[2], parts[1], false);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsection_name = section_name.replace(/^#/g, '');\r\n\t\tif(typeof _.settings.section_url === 'function') url = _.settings.section_url.call(self, section_name);\r\n\r\n\t\t$.ajax({url: url, dataType: 'text'})\r\n\t\t.done(function(result) {\r\n\t\t\t//find the title for this dialog by looking for a tag that has data-id attribute\r\n\t\t\tvar title = '', excerpt = '';\r\n\t\t\t\r\n\t\t\tif(typeof _.settings.section_title === 'function') title = _.settings.section_title.call(self, result, section_name, url);\r\n\t\t\telse {\r\n\t\t\t\tvar escapeSpecialChars = function(name) {\r\n\t\t\t\t\treturn name.replace(/[\\-\\.\\(\\)\\=\\\"\\'\\\\\\/]/g, function(a,b){return \"\\\\\"+a;})\r\n\t\t\t\t}\r\n\t\t\t\tvar tname = section_name;\r\n\t\t\t\twhile(title.length == 0) {\t\r\n\t\t\t\t\tvar reg_str = '\\\\<([a-z][a-z0-9]*)(?:\\\\s+)(?:[^\\\\<\\\\>]+?)data\\\\-id\\\\=\\\\\"\\\\#'+escapeSpecialChars(tname)+'\\\\\"(?:[^\\\\>]*)\\\\>([\\\\s\\\\S]*?)</\\\\1>';\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar regexp = new RegExp(reg_str , \"im\");\r\n\t\t\t\t\tvar arr = result.match(reg_str);\r\n\t\t\t\t\tif(arr && arr[2]) {\r\n\t\t\t\t\t\ttitle = arr[2];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t//if no \"#something.part\" was not found try looking for \"#something\" instead\r\n\t\t\t\t\tvar tpos\r\n\t\t\t\t\tif((tpos = tname.lastIndexOf('.')) > -1) {\r\n\t\t\t\t\t\ttname = tname.substr(0, tpos);\r\n\t\t\t\t\t} else break;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\thelp_modal.find('.modal-title').html( $.trim(title) || '&nbsp;' );\r\n\r\n\t\t\tif(typeof _.settings.section_content === 'function') excerpt = _.settings.section_content.call(self, result, section_name, url);\r\n\t\t\telse {\r\n\t\t\t\tvar find1 = '<!-- #section:'+section_name+' -->';\r\n\t\t\t\tvar pos1 = result.indexOf(find1);\r\n\t\t\t\tvar pos2 = result.indexOf('<!-- /section:'+section_name+' -->', pos1);\r\n\r\n\t\t\t\tif(pos1 == -1 || pos2 == -1) {\r\n\t\t\t\t\thelp_modal.find('.modal-title').html( '&nbsp;' );\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\texcerpt = result.substring(pos1 + find1.length + 1, pos2);\r\n\t\t\t}\r\n\r\n\t\t\t\r\n\t\t\t//convert `<` and `>` to `&lt;` and `&gt;` inside code snippets\r\n\t\t\tif(typeof _.settings.code_highlight === 'function') {\r\n\t\t\t\texcerpt = _.settings.code_highlight.call(self, excerpt);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t//find prism & rainbow style pre tags and replace < > characters with &lt; &gt;\r\n\t\t\t\texcerpt =\r\n\t\t\t\texcerpt.replace(/\\<pre((?:(?:.*?)(?:data\\-language=[\"'](?:[\\w\\d]+)[\"'])(?:.*?))|(?:(?:.*?)(?:class=[\"'](?:.*?)language\\-(?:[\\w\\d]+)(?:.*?)[\"'])(?:.*?)))\\>([\\s\\S]+?)\\<\\/pre\\>/ig, function(a, b, c){\r\n\t\t\t\t\treturn '<pre'+(b)+'>'+c.replace(/\\</g , '&lt;').replace(/\\>/g , '&gt;')+'</pre>';\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\r\n\t\t\t//modify image paths if needed!\r\n\t\t\tif(typeof _.settings.img_url === 'function') {\r\n\t\t\t\texcerpt = excerpt.replace(/\\<img(?:(?:.*?)src=[\"']([^\"']+)[\"'])/ig, function(img, src) {\r\n\t\t\t\t\tvar new_src = _.settings.img_url.call(self, src);\r\n\t\t\t\t\treturn img.replace(src, new_src)\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\r\n\t\t\t//now update content area\r\n\t\t\tcontent.empty().append(excerpt);\r\n\t\t\tif(typeof _.settings.code_highlight === 'function') {\r\n\t\t\t\t_.settings.code_highlight.call(self, content);\r\n\t\t\t}\r\n\t\t\telse if(_.settings.code_highlight === 'rainbow') {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tRainbow.color(content[0]);\r\n\t\t\t\t} catch(e) {}\r\n\t\t\t}\r\n\t\t\telse if(_.settings.code_highlight === 'prism') {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tcontent.find('pre[class*=\"language-\"],code[class*=\"language-\"]').each(function() {\r\n\t\t\t\t\t\tPrism.highlightElement(this);\r\n\t\t\t\t\t})\r\n\t\t\t\t} catch(e) {}\r\n\t\t\t}\r\n\r\n\r\n\t\t\t//wrap titles and contents inside panels\r\n\t\t\tif(_.settings.add_panels) {\r\n\t\t\t\tcontent\r\n\t\t\t\t.find(_.settings.panel_content_selector).each(function() {\r\n\t\t\t\t\tvar header = $(this).prevAll(_.settings.panel_content_title);\r\n\t\t\t\t\tif(header.length == 0) return false;\r\n\t\t\t\t\t\r\n\t\t\t\t\theader =\r\n\t\t\t\t\theader.attr('class', 'panel-title')\r\n\t\t\t\t\t.wrapInner('<a class=\"help-panel-toggle\" href=\"#\" data-parent=\"#\" data-toggle=\"collapse\" />')\r\n\t\t\t\t\t.wrap('<div class=\"panel-heading\" />')\r\n\t\t\t\t\t.closest('.panel-heading');\r\n\r\n\t\t\t\t\t$(this).wrap('<div class=\"panel panel-default panel-help\"><div class=\"panel-collapse collapse\"><div class=\"panel-body\"></div></div></div>');\r\n\t\t\t\t\t$(this).closest('.panel').prepend(header);\r\n\t\t\t\t})\r\n\t\t\t\t\t\t\t\r\n\t\t\t\tvar group_count = $('.panel-group').length;\r\n\t\t\t\tcontent.find('.panel').each(function() {\r\n\t\t\t\t\tif( $(this).parent().hasClass('panel-group') ) return;\r\n\r\n\t\t\t\t\tvar group_id = 'panel-group-help-'+ (++group_count);\r\n\t\t\t\t\tvar group = $('<div class=\"panel-group\" />').insertBefore(this);\r\n\t\t\t\t\tgroup.attr('id', group_id);\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar panel_id = 0;\r\n\t\t\t\t\tgroup.siblings('.panel').appendTo(group);\r\n\t\t\t\t\tgroup.find('.help-panel-toggle')\r\n\t\t\t\t\t.append('<i class=\"pull-right ace-icon fa fa-plus\" data-icon-show=\"ace-icon fa fa-plus\" data-icon-hide=\"ace-icon fa fa-minus\"></i>')\r\n\t\t\t\t\t.attr('data-parent', '#'+group_id)\r\n\t\t\t\t\t.each(function() {\r\n\t\t\t\t\t\tpanel_id++;\r\n\t\t\t\t\t\t$(this).attr('data-target', '#'+group_id+'-'+panel_id);\r\n\t\t\t\t\t\t$(this).closest('.panel-heading').siblings('.panel-collapse').attr('id', group_id+'-'+panel_id);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t\t$(document).off('click.help-panel-toggle', '.help-panel-toggle').on('click.help-panel-toggle', '.help-panel-toggle', function(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\r\n\t\t\t///////////////////////////////////////////\r\n\r\n\t\t\tcontent.removeClass('hidden')\r\n\r\n\t\t\tvar images = content.find('img:visible');\r\n\t\t\tif(images.length > 0) {\r\n\t\t\t\t//handle scrollbars when all images are loaded\r\n\t\t\t\tvar ev_count = 0;\r\n\t\t\t\timages.off('.help_body_scroll').on('load.help_body_scroll error.help_body_scroll', function() {\r\n\t\t\t\t\t$(this).off('.help_body_scroll');\r\n\t\t\t\t\tev_count++;\r\n\t\t\t\t\tif(ev_count >= images.length) disableBodyScroll();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tdisableBodyScroll();\r\n\t\t\tcontent.find('.panel > .panel-collapse').on('shown.bs.collapse hidden.bs.collapse', function() {\r\n\t\t\t\tdisableBodyScroll();\r\n\t\t\t});\r\n\r\n\r\n\t\t\t//save history list\r\n\t\t\tadd_to_nav_list(section_name, save_to_list);\r\n\t\t\r\n\t\t\tvar pos = -1;\r\n\t\t\tif((pos = section_name.lastIndexOf('.')) > -1) {\r\n\t\t\t\tsection_name = section_name.substr(0, pos);\r\n\t\t\t\thelp_modal.find('button[data-navdir=up]').removeClass('disabled').attr('data-url', section_name);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\thelp_modal.find('button[data-navdir=up]').addClass('disabled').removeAttr('data-url').blur();\r\n\t\t\t}\r\n\t\t})\r\n\t\t.fail(function() {\r\n\t\t\thelp_modal.find('.modal-title').find('.fa-spin').remove().end().find('.hidden').children().unwrap();\r\n\t\t});\r\n\t}//launch_help_modal\r\n\r\n\r\n\t$(document).on('click', '.onpage-help-modal a[href^=\"http\"]', function() {\r\n\t\t$(this).attr('target', '_blank');\r\n\t});\r\n\t\r\n\t$(document).on('click', '.help-more', function(e) {\r\n\t\te.preventDefault();\r\n\t\tvar href = $(this).attr('href');\r\n\t\tlaunch_help_modal(href);\r\n\t});\r\n\t\r\n\r\n\t\r\n\tfunction add_to_nav_list(section_name, save_to_list) {\r\n\t\tif(save_to_list !== false) {\r\n\t\t\tif(nav_list.length > 0) {\r\n\t\t\t\tnav_list = nav_list.slice(0, nav_pos + 1);\r\n\t\t\t}\r\n\t\t\tif(nav_list[nav_list.length - 1] != section_name) {\r\n\t\t\t\tnav_list.push(section_name);\r\n\t\t\t\tnav_pos = nav_list.length - 1;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif(nav_pos == 0){\r\n\t\t\thelp_modal.find('button[data-navdir=back]').addClass('disabled').blur();\r\n\t\t}\r\n\t\telse {\r\n\t\t\thelp_modal.find('button[data-navdir=back]').removeClass('disabled');\r\n\t\t}\r\n\t\t\r\n\t\tif(nav_pos == nav_list.length - 1){\r\n\t\t\thelp_modal.find('button[data-navdir=forward]').addClass('disabled').blur();\r\n\t\t}\r\n\t\telse {\r\n\t\t\thelp_modal.find('button[data-navdir=forward]').removeClass('disabled');\r\n\t\t}\r\n\t}\r\n\r\n\t\r\n\t$(document).on('click', '.open-file[data-open-file]', function() {\r\n\t\thelp_modal.find('.modal-title').wrapInner(\"<span class='hidden' />\").append('<i class=\"fa fa-spinner fa-spin blue bigger-125\"></i>');\r\n\t\t$('.onpage-help-content').addClass('hidden')\r\n\r\n\t\tvar url = $(this).attr('data-path') || $(this).text();\r\n\t\tvar language = $(this).attr('data-open-file');\r\n\t\tdisplay_codeview(url, language, true);\r\n\t});\r\n\t\r\n\t\r\n\tfunction display_codeview(url, language, save_to_list) {\r\n\t\tvar $url = url;\r\n\t\r\n\t\tif(typeof _.settings.file_url === 'function') url = _.settings.file_url.call(self, url, language);\r\n\t\t$.ajax({url: url, dataType:'text'})\r\n\t\t.done(function(result) {\r\n\r\n\t\t\tadd_to_nav_list('file:'+language+':'+$url, save_to_list);\r\n\t\t\t\r\n\t\t\thelp_modal.find('button[data-navdir=up]').addClass('disabled').blur();\r\n\t\t\thelp_modal.find('.modal-title').html($url).wrapInner('<code />');\r\n\r\n\t\t\tif(language != 'json') {\r\n\t\t\t\tif(language != 'css') {\r\n\t\t\t\t\t//replace each tab character with two spaces (only those that start at a new line)\r\n\t\t\t\t\tresult = result.replace(/\\n[\\t]{1,}/g, function(p, q) {\r\n\t\t\t\t\t\treturn p.replace(/\\t/g, \"  \");\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult = result.replace(/\\t/g , \"  \")\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlanguage = 'javascript';\r\n\t\t\t\tresult = JSON.stringify(JSON.parse(result), null, 2);//add spacing and somehow beautification\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tresult = result.replace(/\\>/g, '&gt;').replace(/\\</g, '&lt;');\r\n\r\n\t\t\tvar content = $('.onpage-help-content');\r\n\t\t\tcontent.removeClass('hidden').empty();\r\n\r\n\t\t\tif(typeof _.settings.code_highlight === 'function') {\r\n\t\t\t\tresult = _.settings.code_highlight.call(self, result, language);\r\n\t\t\t\tcontent.html(result);\r\n\t\t\t}\r\n\t\t\telse if(_.settings.code_highlight === 'rainbow') {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tRainbow.color(result, language, function(highlighted_code) {\r\n\t\t\t\t\t\tcontent.html(highlighted_code).wrapInner('<pre data-language=\"'+language+'\" />');\r\n\t\t\t\t\t});\r\n\t\t\t\t} catch(e){}\r\n\t\t\t}\r\n\t\t\telse if(_.settings.code_highlight === 'prism') {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tresult = Prism.highlight(result, Prism.languages[language] , language);\r\n\t\t\t\t\tcontent.html(result).wrapInner('<pre class=\"language-'+language+'\" />');\r\n\t\t\t\t} catch(e){}\r\n\t\t\t}\r\n\r\n\t\t});\r\n\t}\r\n\r\n};"],"sourceRoot":"/source/"}