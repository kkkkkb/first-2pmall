{"version":3,"sources":["bootstrap-wysiwyg.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"bootstrap-wysiwyg.js","sourcesContent":["/* http://github.com/mindmup/bootstrap-wysiwyg */\r\n/*global jQuery, $, FileReader*/\r\n/*jslint browser:true*/\r\n(function ($) {\r\n\t'use strict';\r\n\tvar readFileIntoDataUrl = function (fileInfo) {\r\n\t\tvar loader = $.Deferred(),\r\n\t\t\tfReader = new FileReader();\r\n\t\tfReader.onload = function (e) {\r\n\t\t\tloader.resolve(e.target.result);\r\n\t\t};\r\n\t\tfReader.onerror = loader.reject;\r\n\t\tfReader.onprogress = loader.notify;\r\n\t\tfReader.readAsDataURL(fileInfo);\r\n\t\treturn loader.promise();\r\n\t};\r\n\t$.fn.cleanHtml = function () {\r\n\t\tvar html = $(this).html();\r\n\t\treturn html && html.replace(/(<br>|\\s|<div><br><\\/div>|&nbsp;)*$/, '');\r\n\t};\r\n\t$.fn.wysiwyg = function (userOptions) {\r\n\t\tvar editor = this,\r\n\t\t\tselectedRange,\r\n\t\t\toptions,\r\n\t\t\ttoolbarBtnSelector,\r\n\t\t\tupdateToolbar = function () {\r\n\t\t\t\tif (options.activeToolbarClass) {\r\n\t\t\t\t\t$(options.toolbarSelector).find(toolbarBtnSelector).each(function () {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tvar command = $(this).data(options.commandRole);\r\n\t\t\t\t\t\t\tif (document.queryCommandState(command)) {\r\n\t\t\t\t\t\t\t\t$(this).addClass(options.activeToolbarClass);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$(this).removeClass(options.activeToolbarClass);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} catch(e){}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\texecCommand = function (commandWithArgs, valueArg) {\r\n\t\t\t\tvar commandArr = commandWithArgs.split(' '),\r\n\t\t\t\t\tcommand = commandArr.shift(),\r\n\t\t\t\t\targs = commandArr.join(' ') + (valueArg || '');\r\n\t\t\t\tdocument.execCommand(command, 0, args);\r\n\t\t\t\tupdateToolbar();\r\n\t\t\t},\r\n\t\t\tbindHotkeys = function (hotKeys) {\r\n\t\t\t\t$.each(hotKeys, function (hotkey, command) {\r\n\t\t\t\t\teditor.keydown(hotkey, function (e) {\r\n\t\t\t\t\t\tif (editor.attr('contenteditable') && editor.is(':visible')) {\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t\texecCommand(command);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).keyup(hotkey, function (e) {\r\n\t\t\t\t\t\tif (editor.attr('contenteditable') && editor.is(':visible')) {\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tgetCurrentRange = function () {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tvar sel = window.getSelection();\r\n\t\t\t\t\tif (sel.getRangeAt && sel.rangeCount) {\r\n\t\t\t\t\t\treturn sel.getRangeAt(0);\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch(e){}\r\n\t\t\t},\r\n\t\t\tsaveSelection = function () {\r\n\t\t\t\tselectedRange = getCurrentRange();\r\n\t\t\t},\r\n\t\t\trestoreSelection = function () {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tvar selection = window.getSelection();\r\n\t\t\t\t\tif (selectedRange) {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tselection.removeAllRanges();\r\n\t\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t\tdocument.body.createTextRange().select();\r\n\t\t\t\t\t\t\tdocument.selection.empty();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tselection.addRange(selectedRange);\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch(e){}\r\n\t\t\t},\r\n\t\t\tinsertFiles = function (files) {\r\n\t\t\t\teditor.focus();\r\n\t\t\t\t$.each(files, function (idx, fileInfo) {\r\n\t\t\t\t\tif (/^image\\//.test(fileInfo.type)) {\r\n\t\t\t\t\t\t$.when(readFileIntoDataUrl(fileInfo)).done(function (dataUrl) {\r\n\t\t\t\t\t\t\texecCommand('insertimage', dataUrl);\r\n\t\t\t\t\t\t}).fail(function (e) {\r\n\t\t\t\t\t\t\toptions.fileUploadError(\"file-reader\", e);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\toptions.fileUploadError(\"unsupported-file-type\", fileInfo.type);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tmarkSelection = function (input, color) {\r\n\t\t\t\trestoreSelection();\r\n\t\t\t\tif (document.queryCommandSupported('hiliteColor')) {\r\n\t\t\t\t\tdocument.execCommand('hiliteColor', 0, color || 'transparent');\r\n\t\t\t\t}\r\n\t\t\t\tsaveSelection();\r\n\t\t\t\tinput.data(options.selectionMarker, color);\r\n\t\t\t},\r\n\t\t\tbindToolbar = function (toolbar, options) {\r\n\t\t\t\ttoolbar.find(toolbarBtnSelector).click(function () {\r\n\t\t\t\t\trestoreSelection();\r\n\t\t\t\t\teditor.focus();\r\n\t\t\t\t\texecCommand($(this).data(options.commandRole));\r\n\t\t\t\t\tsaveSelection();\r\n\t\t\t\t});\r\n\t\t\t\ttoolbar.find('[data-toggle=dropdown]').click(restoreSelection);\r\n\r\n\t\t\t\t\r\n\t\t\t\t//ACE\r\n\t\t\t\t//ie 9-11\r\n\t\t\t\tvar is_ie = !!window.navigator.msPointerEnabled || (!!document.all && !!document.addEventListener);\r\n\r\n\t\t\t\ttoolbar.find('input[type=text][data-' + options.commandRole + ']').on('webkitspeechchange change', function () {\r\n\t\t\t\t\tvar newValue = this.value; /* ugly but prevents fake double-calls due to selection restoration */\r\n\t\t\t\t\tthis.value = '';\r\n\t\t\t\t\trestoreSelection();\r\n\t\t\t\t\tif (newValue) {\r\n\t\t\t\t\t\teditor.focus();\r\n\t\t\t\t\t\texecCommand($(this).data(options.commandRole), newValue);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsaveSelection();\r\n\t\t\t\t}).on('focus', function () {\r\n\t\t\t\t\t//if IE return, not needed\r\n\t\t\t\t\tif(is_ie) return;//ACE\r\n\t\t\t\t\r\n\t\t\t\t\tvar input = $(this);\r\n\t\t\t\t\tif (!input.data(options.selectionMarker)) {\r\n\t\t\t\t\t\tmarkSelection(input, options.selectionColor);\r\n\t\t\t\t\t\tinput.focus();\r\n\t\t\t\t\t}\r\n\t\t\t\t}).on('blur', function () {\r\n\t\t\t\t\t//if IE return, not needed\r\n\t\t\t\t\tif(is_ie) return;//ACE\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar input = $(this);\r\n\t\t\t\t\tif (input.data(options.selectionMarker)) {\r\n\t\t\t\t\t\tmarkSelection(input, false);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\ttoolbar.find('input[type=file][data-' + options.commandRole + ']').change(function () {\r\n\t\t\t\t\trestoreSelection();\r\n\t\t\t\t\tif (this.type === 'file' && this.files && this.files.length > 0) {\r\n\t\t\t\t\t\tinsertFiles(this.files);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsaveSelection();\r\n\t\t\t\t\tthis.value = '';\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tinitFileDrops = function () {\r\n\t\t\t\teditor.on('dragenter dragover', false)\r\n\t\t\t\t\t.on('drop', function (e) {\r\n\t\t\t\t\t\tvar dataTransfer = e.originalEvent.dataTransfer;\r\n\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tif (dataTransfer && dataTransfer.files && dataTransfer.files.length > 0) {\r\n\t\t\t\t\t\t\tinsertFiles(dataTransfer.files);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t};\r\n\t\toptions = $.extend({}, $.fn.wysiwyg.defaults, userOptions);\r\n\t\ttoolbarBtnSelector = 'a[data-' + options.commandRole + '],button[data-' + options.commandRole + '],input[type=button][data-' + options.commandRole + ']';\r\n\t\tbindHotkeys(options.hotKeys);\r\n\t\tif (options.dragAndDropImages) {\r\n\t\t\tinitFileDrops();\r\n\t\t}\r\n\t\tbindToolbar($(options.toolbarSelector), options);\r\n\t\teditor.attr('contenteditable', true)\r\n\t\t\t.on('mouseup keyup mouseout', function () {\r\n\t\t\t\tsaveSelection();\r\n\t\t\t\tupdateToolbar();\r\n\t\t\t});\r\n\t\t$(window).on('touchend', function (e) {\r\n\t\t\tvar isInside = (editor.is(e.target) || editor.has(e.target).length > 0),\r\n\t\t\t\tcurrentRange = getCurrentRange(),\r\n\t\t\t\tclear = currentRange && (currentRange.startContainer === currentRange.endContainer && currentRange.startOffset === currentRange.endOffset);\r\n\t\t\tif (!clear || isInside) {\r\n\t\t\t\tsaveSelection();\r\n\t\t\t\tupdateToolbar();\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn this;\r\n\t};\r\n\t$.fn.wysiwyg.defaults = {\r\n\t\thotKeys: {\r\n\t\t\t'ctrl+b meta+b': 'bold',\r\n\t\t\t'ctrl+i meta+i': 'italic',\r\n\t\t\t'ctrl+u meta+u': 'underline',\r\n\t\t\t'ctrl+z meta+z': 'undo',\r\n\t\t\t'ctrl+y meta+y meta+shift+z': 'redo',\r\n\t\t\t'ctrl+l meta+l': 'justifyleft',\r\n\t\t\t'ctrl+r meta+r': 'justifyright',\r\n\t\t\t'ctrl+e meta+e': 'justifycenter',\r\n\t\t\t'ctrl+j meta+j': 'justifyfull',\r\n\t\t\t'shift+tab': 'outdent',\r\n\t\t\t'tab': 'indent'\r\n\t\t},\r\n\t\ttoolbarSelector: '[data-role=editor-toolbar]',\r\n\t\tcommandRole: 'edit',\r\n\t\tactiveToolbarClass: 'btn-info',\r\n\t\tselectionMarker: 'edit-focus-marker',\r\n\t\tselectionColor: 'darkgrey',\r\n\t\tdragAndDropImages: true,\r\n\t\tfileUploadError: function (reason, detail) { console.log(\"File upload error\", reason, detail); }\r\n\t};\r\n}(window.jQuery));\r\n"],"sourceRoot":"/source/"}