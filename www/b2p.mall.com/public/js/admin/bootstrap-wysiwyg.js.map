{"version":3,"sources":["bootstrap-wysiwyg.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"bootstrap-wysiwyg.js","sourcesContent":["/* http://github.com/mindmup/bootstrap-wysiwyg */\n/*global jQuery, $, FileReader*/\n/*jslint browser:true*/\n(function ($) {\n\t'use strict';\n\tvar readFileIntoDataUrl = function (fileInfo) {\n\t\tvar loader = $.Deferred(),\n\t\t\tfReader = new FileReader();\n\t\tfReader.onload = function (e) {\n\t\t\tloader.resolve(e.target.result);\n\t\t};\n\t\tfReader.onerror = loader.reject;\n\t\tfReader.onprogress = loader.notify;\n\t\tfReader.readAsDataURL(fileInfo);\n\t\treturn loader.promise();\n\t};\n\t$.fn.cleanHtml = function () {\n\t\tvar html = $(this).html();\n\t\treturn html && html.replace(/(<br>|\\s|<div><br><\\/div>|&nbsp;)*$/, '');\n\t};\n\t$.fn.wysiwyg = function (userOptions) {\n\t\tvar editor = this,\n\t\t\tselectedRange,\n\t\t\toptions,\n\t\t\ttoolbarBtnSelector,\n\t\t\tupdateToolbar = function () {\n\t\t\t\tif (options.activeToolbarClass) {\n\t\t\t\t\t$(options.toolbarSelector).find(toolbarBtnSelector).each(function () {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tvar command = $(this).data(options.commandRole);\n\t\t\t\t\t\t\tif (document.queryCommandState(command)) {\n\t\t\t\t\t\t\t\t$(this).addClass(options.activeToolbarClass);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t$(this).removeClass(options.activeToolbarClass);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch(e){}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\texecCommand = function (commandWithArgs, valueArg) {\n\t\t\t\tvar commandArr = commandWithArgs.split(' '),\n\t\t\t\t\tcommand = commandArr.shift(),\n\t\t\t\t\targs = commandArr.join(' ') + (valueArg || '');\n\t\t\t\tdocument.execCommand(command, 0, args);\n\t\t\t\tupdateToolbar();\n\t\t\t},\n\t\t\tbindHotkeys = function (hotKeys) {\n\t\t\t\t$.each(hotKeys, function (hotkey, command) {\n\t\t\t\t\teditor.keydown(hotkey, function (e) {\n\t\t\t\t\t\tif (editor.attr('contenteditable') && editor.is(':visible')) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\texecCommand(command);\n\t\t\t\t\t\t}\n\t\t\t\t\t}).keyup(hotkey, function (e) {\n\t\t\t\t\t\tif (editor.attr('contenteditable') && editor.is(':visible')) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t},\n\t\t\tgetCurrentRange = function () {\n\t\t\t\ttry {\n\t\t\t\t\tvar sel = window.getSelection();\n\t\t\t\t\tif (sel.getRangeAt && sel.rangeCount) {\n\t\t\t\t\t\treturn sel.getRangeAt(0);\n\t\t\t\t\t}\n\t\t\t\t} catch(e){}\n\t\t\t},\n\t\t\tsaveSelection = function () {\n\t\t\t\tselectedRange = getCurrentRange();\n\t\t\t},\n\t\t\trestoreSelection = function () {\n\t\t\t\ttry {\n\t\t\t\t\tvar selection = window.getSelection();\n\t\t\t\t\tif (selectedRange) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tselection.removeAllRanges();\n\t\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t\tdocument.body.createTextRange().select();\n\t\t\t\t\t\t\tdocument.selection.empty();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tselection.addRange(selectedRange);\n\t\t\t\t\t}\n\t\t\t\t} catch(e){}\n\t\t\t},\n\t\t\tinsertFiles = function (files) {\n\t\t\t\teditor.focus();\n\t\t\t\t$.each(files, function (idx, fileInfo) {\n\t\t\t\t\tif (/^image\\//.test(fileInfo.type)) {\n\t\t\t\t\t\t$.when(readFileIntoDataUrl(fileInfo)).done(function (dataUrl) {\n\t\t\t\t\t\t\texecCommand('insertimage', dataUrl);\n\t\t\t\t\t\t}).fail(function (e) {\n\t\t\t\t\t\t\toptions.fileUploadError(\"file-reader\", e);\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\toptions.fileUploadError(\"unsupported-file-type\", fileInfo.type);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tmarkSelection = function (input, color) {\n\t\t\t\trestoreSelection();\n\t\t\t\tif (document.queryCommandSupported('hiliteColor')) {\n\t\t\t\t\tdocument.execCommand('hiliteColor', 0, color || 'transparent');\n\t\t\t\t}\n\t\t\t\tsaveSelection();\n\t\t\t\tinput.data(options.selectionMarker, color);\n\t\t\t},\n\t\t\tbindToolbar = function (toolbar, options) {\n\t\t\t\ttoolbar.find(toolbarBtnSelector).click(function () {\n\t\t\t\t\trestoreSelection();\n\t\t\t\t\teditor.focus();\n\t\t\t\t\texecCommand($(this).data(options.commandRole));\n\t\t\t\t\tsaveSelection();\n\t\t\t\t});\n\t\t\t\ttoolbar.find('[data-toggle=dropdown]').click(restoreSelection);\n\n\t\t\t\t\n\t\t\t\t//ACE\n\t\t\t\t//ie 9-11\n\t\t\t\tvar is_ie = !!window.navigator.msPointerEnabled || (!!document.all && !!document.addEventListener);\n\n\t\t\t\ttoolbar.find('input[type=text][data-' + options.commandRole + ']').on('webkitspeechchange change', function () {\n\t\t\t\t\tvar newValue = this.value; /* ugly but prevents fake double-calls due to selection restoration */\n\t\t\t\t\tthis.value = '';\n\t\t\t\t\trestoreSelection();\n\t\t\t\t\tif (newValue) {\n\t\t\t\t\t\teditor.focus();\n\t\t\t\t\t\texecCommand($(this).data(options.commandRole), newValue);\n\t\t\t\t\t}\n\t\t\t\t\tsaveSelection();\n\t\t\t\t}).on('focus', function () {\n\t\t\t\t\t//if IE return, not needed\n\t\t\t\t\tif(is_ie) return;//ACE\n\t\t\t\t\n\t\t\t\t\tvar input = $(this);\n\t\t\t\t\tif (!input.data(options.selectionMarker)) {\n\t\t\t\t\t\tmarkSelection(input, options.selectionColor);\n\t\t\t\t\t\tinput.focus();\n\t\t\t\t\t}\n\t\t\t\t}).on('blur', function () {\n\t\t\t\t\t//if IE return, not needed\n\t\t\t\t\tif(is_ie) return;//ACE\n\t\t\t\t\t\n\t\t\t\t\tvar input = $(this);\n\t\t\t\t\tif (input.data(options.selectionMarker)) {\n\t\t\t\t\t\tmarkSelection(input, false);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\ttoolbar.find('input[type=file][data-' + options.commandRole + ']').change(function () {\n\t\t\t\t\trestoreSelection();\n\t\t\t\t\tif (this.type === 'file' && this.files && this.files.length > 0) {\n\t\t\t\t\t\tinsertFiles(this.files);\n\t\t\t\t\t}\n\t\t\t\t\tsaveSelection();\n\t\t\t\t\tthis.value = '';\n\t\t\t\t});\n\t\t\t},\n\t\t\tinitFileDrops = function () {\n\t\t\t\teditor.on('dragenter dragover', false)\n\t\t\t\t\t.on('drop', function (e) {\n\t\t\t\t\t\tvar dataTransfer = e.originalEvent.dataTransfer;\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tif (dataTransfer && dataTransfer.files && dataTransfer.files.length > 0) {\n\t\t\t\t\t\t\tinsertFiles(dataTransfer.files);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t};\n\t\toptions = $.extend({}, $.fn.wysiwyg.defaults, userOptions);\n\t\ttoolbarBtnSelector = 'a[data-' + options.commandRole + '],button[data-' + options.commandRole + '],input[type=button][data-' + options.commandRole + ']';\n\t\tbindHotkeys(options.hotKeys);\n\t\tif (options.dragAndDropImages) {\n\t\t\tinitFileDrops();\n\t\t}\n\t\tbindToolbar($(options.toolbarSelector), options);\n\t\teditor.attr('contenteditable', true)\n\t\t\t.on('mouseup keyup mouseout', function () {\n\t\t\t\tsaveSelection();\n\t\t\t\tupdateToolbar();\n\t\t\t});\n\t\t$(window).on('touchend', function (e) {\n\t\t\tvar isInside = (editor.is(e.target) || editor.has(e.target).length > 0),\n\t\t\t\tcurrentRange = getCurrentRange(),\n\t\t\t\tclear = currentRange && (currentRange.startContainer === currentRange.endContainer && currentRange.startOffset === currentRange.endOffset);\n\t\t\tif (!clear || isInside) {\n\t\t\t\tsaveSelection();\n\t\t\t\tupdateToolbar();\n\t\t\t}\n\t\t});\n\t\treturn this;\n\t};\n\t$.fn.wysiwyg.defaults = {\n\t\thotKeys: {\n\t\t\t'ctrl+b meta+b': 'bold',\n\t\t\t'ctrl+i meta+i': 'italic',\n\t\t\t'ctrl+u meta+u': 'underline',\n\t\t\t'ctrl+z meta+z': 'undo',\n\t\t\t'ctrl+y meta+y meta+shift+z': 'redo',\n\t\t\t'ctrl+l meta+l': 'justifyleft',\n\t\t\t'ctrl+r meta+r': 'justifyright',\n\t\t\t'ctrl+e meta+e': 'justifycenter',\n\t\t\t'ctrl+j meta+j': 'justifyfull',\n\t\t\t'shift+tab': 'outdent',\n\t\t\t'tab': 'indent'\n\t\t},\n\t\ttoolbarSelector: '[data-role=editor-toolbar]',\n\t\tcommandRole: 'edit',\n\t\tactiveToolbarClass: 'btn-info',\n\t\tselectionMarker: 'edit-focus-marker',\n\t\tselectionColor: 'darkgrey',\n\t\tdragAndDropImages: true,\n\t\tfileUploadError: function (reason, detail) { console.log(\"File upload error\", reason, detail); }\n\t};\n}(window.jQuery));\n"],"sourceRoot":"/source/"}