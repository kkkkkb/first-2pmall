{"version":3,"sources":["orderList.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"orderList.js","sourcesContent":["/**\r\n * base javascript\r\n * @authors CK-Joey (zhangjie.tk)\r\n * @date    2016-08-19 01:07:00\r\n * @version 1.0\r\n */\r\n'use strict';\r\n\r\nvar order_list = {\r\n    init: function(){\r\n        // tab 切换\r\n        this.tabSwitch();\r\n\r\n        // 滚动加载更多\r\n        this.scrollLoadMore();\r\n    },\r\n    tabSwitch: function(){\r\n        var that = this;\r\n        var ajaxUrl = '';\r\n        //点击tab事件\r\n        $('#order_tab li').on('click', function(){\r\n            var _this = this;\r\n            // 获取请求地址\r\n            ajaxUrl = $(this).parents('ul').data('url');\r\n            // 获取当前请求类型\r\n            var dataType = $(this).data('type');\r\n            // 请求数据\r\n            $.ajax({\r\n                url: ajaxUrl,\r\n                type: 'get',\r\n                dataType: 'json',\r\n                data: {type: dataType}\r\n            })\r\n            .done(function(re){\r\n                // 拼接列表\r\n                var h = that._dataPj(re);\r\n                // 修改下一页页码\r\n                $('#order_content').data('next-page', re.response_data.next_page);\r\n                // 修改tab样式\r\n                $(_this).addClass('on').siblings('li').removeClass('on');\r\n                // 将拼接的html放到页面容器中\r\n                $('#order_content').html(h);\r\n            })\r\n            .fail(function(){\r\n                console.log('请求接口失败!');\r\n            });\r\n        });\r\n    },\r\n    // 滚动加载更多\r\n    scrollLoadMore: function(){\r\n        var _this = this;\r\n        // 是否进行加载数据\r\n        var status = true;\r\n        // 请求地址\r\n        var ajaxUrl = $('#order_tab').data('url');\r\n        // 下一页数值\r\n        var nextPage = $('#order_content').data('next-page');\r\n        // 窗口高度\r\n        var winHeight = $(window).height();\r\n        // 获取当前加载订单类型\r\n        var orderType = $('#order_tab li.on').data('type');\r\n\r\n        // 监听页面滚动事件\r\n        $(document).scroll(function(){\r\n            // 获取当前滚动的距离\r\n            var scrollTopVal = $(document).scrollTop();\r\n            // 文档的高度\r\n            var docHeight = $(document).height();\r\n            // 加载距离\r\n            var loadDistance = winHeight + scrollTopVal;\r\n\r\n            // 当文档高度等于加载距离是进行加载并且判断是否可以进行ajax请求\r\n            if(loadDistance == docHeight && status && nextPage != ''){\r\n                // 将加载状态设置为不可加载，以避免重复请求\r\n                status = false;\r\n                // 改变提示文字\r\n                $('#load_point').html('数据加载中……');\r\n                // ajax请求数据列表\r\n                $.ajax({\r\n                    url: ajaxUrl,\r\n                    type: 'GET',\r\n                    dataType: 'json',\r\n                    data: {type: orderType, page: nextPage},\r\n                })\r\n                .done(function(re) {\r\n                    var h = _this._dataPj(re);\r\n\r\n                    // 将加载状态设置为可加载\r\n                    status = true;\r\n                    // 将拼接的html放到页面容器中\r\n                    $('#order_content').append(h);\r\n                    console.log(\"success\", re);\r\n                })\r\n                .fail(function() {\r\n                    // 将加载状态设置为可加载\r\n                    status = true;\r\n                    // 改变提示文字\r\n                    $('#load_point').html('加载失败！请刷新页面重新加载！');\r\n                    console.log(\"error\");\r\n                });\r\n            }else{\r\n                // 改变提示文字\r\n                $('#load_point').html('没有更多的数据了！');\r\n            }\r\n        });\r\n    },\r\n    // 数据拼接\r\n    _dataPj:function(re){\r\n        var h = '';\r\n        // 拼接列表\r\n        if(re.response_data.order_list.length == null){\r\n            h = '<p class=\"no_order\">暂无订单！</p>';\r\n        }else{\r\n            $.each(re.response_data.order_list, function() {\r\n                h += '<li>'+\r\n                    '<div class=\"order_time\">'+ this.created_at + '</div>'+\r\n                    '<div class=\"goods_info\">'+\r\n                        '<div class=\"goods_img\">'+\r\n                            '<a href=\"'+ this.goods_url + '\">'+\r\n                                '<img src=\"'+ this.orderGoods[0].goods_img_url +'\" alt=\"'+ this.orderGoods[0].goods_title +'\">'+\r\n                            '</a>'+\r\n                        '</div>'+\r\n\r\n                        '<div class=\"goods_name\">'+\r\n                            '<p>'+ this.orderGoods[0].goods_title + ' '+ this.orderGoods[0].goods_spec + '</p>'+\r\n                            '<p>数量：'+ this.orderGoods[0].goods_number + '</p>'+\r\n                            '<p>&nbsp;<!-- 库存：1000件 --></p>'+\r\n                        '</div>'+\r\n\r\n                        '<div class=\"goods_price\">'+\r\n                            '<span>&yen;<big id=\"goods_price\">'+ this.orderGoods[0].buy_price + '</big>/件</span>'+\r\n                        '</div>'+\r\n                    '</div>'+\r\n                    '<div class=\"goods_sum\">'+\r\n                        '共1件商品'+\r\n                        '<span>实付：<big id=\"pay_price\">&yen;'+ this.order_amount + '</big></span>'+\r\n                    '</div>'+\r\n                    '<div class=\"order_status\">'+\r\n                        '<!-- <span>待支付</span> -->'+\r\n                        '<!-- <a href=\"\" class=\"go_to_buy\">去支付</a> -->'+\r\n                        '<!-- <a href=\"\">取消订单</a> -->'+\r\n                        (this.is_share ? '<a href=\"\" class=\"share_pt\">分享拼团</a>' : '') +\r\n                        (this.join_group ? '<a href=\"'+ this.join_group + '\" class=\"join_pt\">加入拼团</a>' : '')+\r\n                    '</div>'+\r\n                    (this.is_end ? '<div class=\"is_over\">拼团已结束</div>' : '') +\r\n                    (this.wait_cashback ? '<div class=\"backtrack_money\">等待返回拼团优惠金</div>' : '') +\r\n                '</li>';\r\n            });\r\n        }\r\n        return h;\r\n    }\r\n};\r\n\r\n$(function(){\r\n    order_list.init();\r\n});"],"sourceRoot":"/source/"}