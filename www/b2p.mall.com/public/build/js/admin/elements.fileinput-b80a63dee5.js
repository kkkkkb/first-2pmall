!function(e,t){var i="multiple"in document.createElement("INPUT"),n="FileList"in window,a="FileReader"in window,s="File"in window,l=function(t,i){var n=this,a=ace.helper.getAttrSettings(t,e.fn.ace_file_input.defaults);this.settings=e.extend({},e.fn.ace_file_input.defaults,i,a),this.$element=e(t),this.element=t,this.disabled=!1,this.can_reset=!0,this.$element.off("change.ace_inner_call").on("change.ace_inner_call",function(e,t){if(!n.disabled&&t!==!0)return o.call(n)});var s=this.$element.closest("label").css({display:"block"}),l=0==s.length?"label":"span";this.$element.wrap("<"+l+' class="ace-file-input" />'),this.apply_settings(),this.reset_input_field()};l.error={FILE_LOAD_FAILED:1,IMAGE_LOAD_FAILED:2,THUMBNAIL_FAILED:3},l.prototype.apply_settings=function(){var t=this;this.multi=this.$element.attr("multiple")&&i,this.well_style="well"==this.settings.style,this.well_style?(this.settings.thumbnail||(this.settings.thumbnail="small"),this.$element.parent().addClass("ace-file-multiple")):this.$element.parent().removeClass("ace-file-multiple"),this.$element.parent().find(":not(input[type=file])").remove(),this.$element.after('<span class="ace-file-container" data-title="'+this.settings.btn_choose+'"><span class="ace-file-name" data-title="'+this.settings.no_file+'">'+(this.settings.no_icon?'<i class="'+ace.vars.icon+this.settings.no_icon+'"></i>':"")+"</span></span>"),this.$label=this.$element.next(),this.$container=this.$element.closest(".ace-file-input");var a=!!this.settings.icon_remove;if(a){var s=e('<a class="remove" href="#"><i class="'+ace.vars.icon+this.settings.icon_remove+'"></i></a>').appendTo(this.$element.parent());s.on(ace.click_event,function(e){if(e.preventDefault(),!t.can_reset)return!1;var i=!0;if(t.settings.before_remove&&(i=t.settings.before_remove.call(t.element)),!i)return!1;t.reset_input();return!1})}this.settings.droppable&&n&&r.call(this)},l.prototype.show_file_list=function(t,i){var n="undefined"==typeof t?this.$element.data("ace_input_files"):t;if(n&&0!=n.length){this.well_style&&(this.$label.find(".ace-file-name").remove(),this.settings.btn_change||this.$label.addClass("hide-placeholder")),this.$label.attr("data-title",this.settings.btn_change).addClass("selected");for(var l=0;l<n.length;l++){var r="",o=!1;if("string"==typeof n[l])r=n[l];else if(s&&n[l]instanceof File)r=e.trim(n[l].name);else{if(!(n[l]instanceof Object&&n[l].hasOwnProperty("name")))continue;r=n[l].name,n[l].hasOwnProperty("type")&&(o=n[l].type),n[l].hasOwnProperty("path")||(n[l].path=n[l].name)}var f=r.lastIndexOf("\\")+1;0==f&&(f=r.lastIndexOf("/")+1),r=r.substr(f),0==o&&(o=/\.(jpe?g|png|gif|svg|bmp|tiff?)$/i.test(r)?"image":/\.(mpe?g|flv|mov|avi|swf|mp4|mkv|webm|wmv|3gp)$/i.test(r)?"video":/\.(mp3|ogg|wav|wma|amr|aac)$/i.test(r)?"audio":"file");var c={file:"fa fa-file",image:"fa fa-picture-o file-image",video:"fa fa-film file-video",audio:"fa fa-music file-audio"},p=c[o];if(this.well_style){this.$label.append('<span class="ace-file-name" data-title="'+r+'"><i class="'+ace.vars.icon+p+'"></i></span>');var u=i===!0&&s&&n[l]instanceof File?e.trim(n[l].type):"",d=a&&this.settings.thumbnail&&(u.length>0&&u.match("image")||0==u.length&&"image"==o);if(d){var m=this;e.when(h.call(this,n[l])).fail(function(e){m.settings.preview_error&&m.settings.preview_error.call(m,r,e.code)})}}else this.$label.find(".ace-file-name").attr({"data-title":r}).find(ace.vars[".icon"]).attr("class",ace.vars.icon+p)}return!0}},l.prototype.reset_input=function(){this.reset_input_ui(),this.reset_input_field()},l.prototype.reset_input_ui=function(){this.$label.attr({"data-title":this.settings.btn_choose,"class":"ace-file-container"}).find(".ace-file-name:first").attr({"data-title":this.settings.no_file,"class":"ace-file-name"}).find(ace.vars[".icon"]).attr("class",ace.vars.icon+this.settings.no_icon).prev("img").remove(),this.settings.no_icon||this.$label.find(ace.vars[".icon"]).remove(),this.$label.find(".ace-file-name").not(":first").remove(),this.reset_input_data()},l.prototype.reset_input_field=function(){this.$element.wrap("<form>").parent().get(0).reset(),this.$element.unwrap()},l.prototype.reset_input_data=function(){this.$element.data("ace_input_files")&&(this.$element.removeData("ace_input_files"),this.$element.removeData("ace_input_method"))},l.prototype.enable_reset=function(e){this.can_reset=e},l.prototype.disable=function(){this.disabled=!0,this.$element.attr("disabled","disabled").addClass("disabled")},l.prototype.enable=function(){this.disabled=!1,this.$element.removeAttr("disabled").removeClass("disabled")},l.prototype.files=function(){return e(this).data("ace_input_files")||null},l.prototype.method=function(){return e(this).data("ace_input_method")||""},l.prototype.update_settings=function(t){this.settings=e.extend({},this.settings,t),this.apply_settings()},l.prototype.loading=function(t){if(t===!1)this.$container.find(".ace-file-overlay").remove(),this.element.removeAttribute("readonly");else{var i="string"==typeof t?t:'<i class="overlay-content fa fa-spin fa-spinner orange2 fa-2x"></i>',n=this.$container.find(".ace-file-overlay");0==n.length&&(n=e('<div class="ace-file-overlay"></div>').appendTo(this.$container),n.on("click tap",function(e){return e.stopImmediatePropagation(),e.preventDefault(),!1}),this.element.setAttribute("readonly","true")),n.empty().append(i)}};var r=function(){var e=this,t=this.$element.parent();t.off("dragenter").on("dragenter",function(e){e.preventDefault(),e.stopPropagation()}).off("dragover").on("dragover",function(e){e.preventDefault(),e.stopPropagation()}).off("drop").on("drop",function(t){if(t.preventDefault(),t.stopPropagation(),!e.disabled){var i=t.originalEvent.dataTransfer,n=i.files;if(!e.multi&&n.length>1){var a=[];a.push(n[0]),n=a}return n=c.call(e,n,!0),n!==!1&&(e.$element.data("ace_input_method","drop"),e.$element.data("ace_input_files",n),e.show_file_list(n,!0),e.$element.triggerHandler("change",[!0]),!0)}})},o=function(){var e=this.element.files||[this.element.value];return e=c.call(this,e,!1),e!==!1&&(this.$element.data("ace_input_method","select"),this.$element.data("ace_input_files",e),this.show_file_list(e,!0),!0)},h=function(t){var i=this,n=i.$label.find(".ace-file-name:last"),a=new e.Deferred,r=function(t,i){n.prepend("<img class='middle' style='display:none;' />");var a=n.find("img:last").get(0);e(a).one("load",function(){o.call(null,a,i)}).one("error",function(){h.call(null,a)}),a.src=t},o=function(t,s){var r=i.settings.previewSize;r||(i.settings.previewWidth||i.settings.previewHeight?r={previewWidth:i.settings.previewWidth,previewHeight:i.settings.previewHeight}:(r=50,"large"==i.settings.thumbnail&&(r=150))),"fit"==i.settings.thumbnail?r=n.width():"number"==typeof r&&(r=parseInt(Math.min(r,n.width())));var o=f(t,r);if(null==o)return e(this).remove(),void a.reject({code:l.error.THUMBNAIL_FAILED});var h=!0;if(s&&s instanceof File){s.width=o.width,s.height=o.height,i.$element.trigger("file.preview.ace",{file:s});var c;i.$element.trigger(c=new e.Event("file.preview.ace"),{file:s}),c.isDefaultPrevented()&&(h=!1)}if(h){var p=o.previewWidth,u=o.previewHeight;"small"==i.settings.thumbnail?p=u=parseInt(Math.max(p,u)):n.addClass("large"),e(t).css({"background-image":"url("+o.src+")",width:p,height:u}).data("thumb",o.src).attr({src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="}).show()}a.resolve()},h=function(e){n.find("img").remove(),a.reject({code:l.error.IMAGE_LOAD_FAILED})};if(s&&t instanceof File){var c=new FileReader;c.onload=function(e){r(e.target.result,t)},c.onerror=function(e){a.reject({code:l.error.FILE_LOAD_FAILED})},c.readAsDataURL(t)}else t instanceof Object&&t.hasOwnProperty("path")&&r(t.path,null);return a.promise()},f=function(t,i,n){var a=t.width,s=t.height;a=a>0?a:e(t).width(),s=s>0?s:e(t).height();var l=!1,r=!1,o=!1;"number"==typeof i?l=i:i instanceof Object&&(i.previewWidth&&!i.previewHeight?o=i.previewWidth:i.previewHeight&&!i.previewWidth?r=i.previewHeight:i.previewWidth&&i.previewHeight&&(o=i.previewWidth,r=i.previewHeight)),l?a>s?(o=l,r=parseInt(s/a*o)):(r=l,o=parseInt(a/s*r)):!r&&o?r=parseInt(s/a*o):r&&!o&&(o=parseInt(a/s*r));var h;try{var f=document.createElement("canvas");f.width=o,f.height=r;var c=f.getContext("2d");c.drawImage(t,0,0,a,s,0,0,o,r),h=f.toDataURL()}catch(p){h=null}return h?(/^data\:image\/(png|jpe?g|gif);base64,[0-9A-Za-z\+\/\=]+$/.test(h)||(h=null),h?{src:h,previewWidth:o,previewHeight:r,width:a,height:s}:null):null},c=function(e,t){var i=d.call(this,e,t);return i===-1?(this.reset_input(),!1):i&&0!=i.length?((i instanceof Array||n&&i instanceof FileList)&&(e=i),i=!0,this.settings.before_change&&(i=this.settings.before_change.call(this.element,e,t)),i===-1?(this.reset_input(),!1):i&&0!=i.length?((i instanceof Array||n&&i instanceof FileList)&&(e=i),e):(this.$element.data("ace_input_files")||this.reset_input(),!1)):(this.$element.data("ace_input_files")||this.reset_input(),!1)},p=function(e){return e?("string"==typeof e&&(e=[e]),0==e.length?null:new RegExp(".(?:"+e.join("|")+")$","i")):null},u=function(e){return e?("string"==typeof e&&(e=[e]),0==e.length?null:new RegExp("^(?:"+e.join("|").replace(/\//g,"\\/")+")$","i")):null},d=function(t,i){var n=p(this.settings.allowExt),a=p(this.settings.denyExt),l=u(this.settings.allowMime),r=u(this.settings.denyMime),o=this.settings.maxSize||!1;if(!(n||a||l||r||o))return!0;for(var h=[],f={},c=0;c<t.length;c++){var d=t[c],m=s?d.name:d;if(!n||n.test(m))if(a&&a.test(m))"ext"in f||(f.ext=[]),f.ext.push(m);else{var g;if(s){if((g=e.trim(d.type)).length>0){if(l&&!l.test(g)){"mime"in f||(f.mime=[]),f.mime.push(m);continue}if(r&&r.test(g)){"mime"in f||(f.mime=[]),f.mime.push(m);continue}}o&&d.size>o?("size"in f||(f.size=[]),f.size.push(m)):h.push(d)}else h.push(d)}else"ext"in f||(f.ext=[]),f.ext.push(m)}if(h.length==t.length)return t;var v={ext:0,mime:0,size:0};"ext"in f&&(v.ext=f.ext.length),"mime"in f&&(v.mime=f.mime.length),"size"in f&&(v.size=f.size.length);var _;return this.$element.trigger(_=new e.Event("file.error.ace"),{file_count:t.length,invalid_count:t.length-h.length,error_list:f,error_count:v,dropped:i}),_.isDefaultPrevented()?-1:h};e.fn.aceFileInput=e.fn.ace_file_input=function(i,n){var a,s=this.each(function(){var t=e(this),s=t.data("ace_file_input"),r="object"==typeof i&&i;s||t.data("ace_file_input",s=new l(this,r)),"string"==typeof i&&(a=s[i](n))});return a===t?s:a},e.fn.ace_file_input.defaults={style:!1,no_file:"No File ...",no_icon:"fa fa-upload",btn_choose:"Choose",btn_change:"Change",icon_remove:"fa fa-times",droppable:!1,thumbnail:!1,allowExt:null,denyExt:null,allowMime:null,denyMime:null,maxSize:!1,previewSize:!1,previewWidth:!1,previewHeight:!1,before_change:null,before_remove:null,preview_error:null}}(window.jQuery);