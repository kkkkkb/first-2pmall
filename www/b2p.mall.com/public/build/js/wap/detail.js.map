{"version":3,"sources":["detail.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"detail.js","sourcesContent":["/**\r\n * base javascript\r\n * @authors CK-Joey (zhangjie.tk)\r\n * @date    2016-08-19 01:07:00\r\n * @version 1.0\r\n */\r\n$(function(){\r\n    // sku选择\r\n    var tmpArr = [];\r\n    $('body').on('click', '.sku_box a', function(){\r\n        var id = $(this).data('id');\r\n        var attrUrl = $(this).parents('#goods_main_box').data('atr-url');\r\n        var sureUrl = $(this).parents('#goods_main_box').data('url');\r\n        var type = $(this).parent().data('type');\r\n        var sureSkuStatus = false;\r\n\r\n        $(this).addClass('cur').siblings('a').removeClass('cur');\r\n\r\n        if($.inArray( type, tmpArr) == -1){\r\n            tmpArr.push(type);\r\n        }\r\n        if(tmpArr.length >= 2){\r\n            sureSkuStatus = true;\r\n        }\r\n\r\n        if(sureSkuStatus && tmpArr.length > 1){\r\n            var data = {\r\n                goods_id: goodsData.goods_id,\r\n                color_attr_val_id: $('[data-type=color] a.cur').data('id'),\r\n                size_attr_val_id: $('[data-type=size] a.cur').data('id')\r\n            };\r\n            $.ajax({\r\n                url: sureUrl,\r\n                type: 'POST',\r\n                dataType: 'json',\r\n                data: data\r\n            })\r\n            .done(function(re) {\r\n                if(re.err_code){\r\n                    attrSelectFun(type, id);\r\n                }else{\r\n                    // 商品价格\r\n                    $('[name=shop_price]').html('&yen;' + parseFloat(re.shop_price).toFixed(2));\r\n\r\n                    // 商品市场价格\r\n                    $('[name=market_price]').html('&yen;' + parseFloat(re.market_price).toFixed(2));\r\n\r\n                    // 商品库存\r\n                    $('[name=stock]').html('库存：'+ re.sku_number +'件');\r\n\r\n                    // 订单连接拼接\r\n                    var payUrl = goodsData.buy_link + '?goods_id=' + goodsData.goods_id + '&sku_id=' + re.id;\r\n                    $('[name=buy_but]').attr('href', payUrl);\r\n                }\r\n            })\r\n            .fail(function(re) {\r\n                console.log(\"error\", re);\r\n            });\r\n        }else{\r\n            attrSelectFun(type, id);\r\n        }\r\n\r\n        // 获取属性方法\r\n        function attrSelectFun(type, id) {\r\n            var data = {\r\n                goods_id: goodsData.goods_id,\r\n                attr_type: type,\r\n                attr_id: id,\r\n            };\r\n            // 清除提交订单的连接\r\n            $('[name=buy_but]').attr('href', 'javascript:void(0);');\r\n\r\n            $.ajax({\r\n                url: attrUrl,\r\n                type: 'POST',\r\n                dataType: 'json',\r\n                data: data\r\n            })\r\n            .done(function(re) {\r\n                if('err_code' in re){\r\n                    alert(re.msg);\r\n                }else{\r\n                    var h = '';\r\n\r\n                    $.each(re, function() {\r\n                        h += '<a data-id=\"'+ this.id +'\" data-attr-id=\"'+ this.attr_id +'\">'+ this.value_name +'</a>';\r\n                    });\r\n\r\n                    if(type == 'size'){\r\n                        $('[data-type=color]').html('颜色：' + h);\r\n                        // tmpArr.splice($.inArray('color', tmpArr), 1);\r\n                    }\r\n\r\n                    if(type == 'color'){\r\n                        $('[data-type=size]').html('规格：' + h);\r\n                        // tmpArr.splice($.inArray('size', tmpArr), 1);\r\n                    }\r\n\r\n                }\r\n            })\r\n            .fail(function(re) {\r\n                console.log(\"error\", re);\r\n            });\r\n        }\r\n    });\r\n});"],"sourceRoot":"/source/"}